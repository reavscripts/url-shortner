// Definizione delle unità e dei loro fattori di conversione rispetto a un'unità base comune per categoria
const units = {
    length: {
        meter: { name: 'Meter', toBase: 1 },
        kilometer: { name: 'Kilometer', toBase: 1000 },
        centimeter: { name: 'Centimeter', toBase: 0.01 },
        millimeter: { name: 'Millimeter', toBase: 0.001 },
        mile: { name: 'Mile', toBase: 1609.34 },
        yard: { name: 'Yard', toBase: 0.9144 },
        foot: { name: 'Foot', toBase: 0.3048 },
        inch: { name: 'Inch', toBase: 0.0254 }
    },
    weight: {
        kilogram: { name: 'Kilogram', toBase: 1 },
        gram: { name: 'Gram', toBase: 0.001 },
        milligram: { name: 'Milligram', toBase: 0.000001 },
        pound: { name: 'Pound', toBase: 0.453592 },
        ounce: { name: 'Ounce', toBase: 0.0283495 },
        ton: { name: 'Ton (metric)', toBase: 1000 }
    },
    temperature: {
        celsius: { name: 'Celsius', toBase: (value) => value, fromBase: (value) => value }, // Base: Celsius
        fahrenheit: { name: 'Fahrenheit', toBase: (value) => (value - 32) * 5/9, fromBase: (value) => (value * 9/5) + 32 },
        kelvin: { name: 'Kelvin', toBase: (value) => value - 273.15, fromBase: (value) => value + 273.15 }
    },
    volume: {
        liter: { name: 'Liter', toBase: 1 },
        milliliter: { name: 'Milliliter', toBase: 0.001 },
        cubicMeter: { name: 'Cubic Meter', toBase: 1000 },
        gallon: { name: 'Gallon (US)', toBase: 3.78541 },
        quart: { name: 'Quart (US)', toBase: 0.946353 },
        pint: { name: 'Pint (US)', toBase: 0.473176 }
    },
    time: {
        second: { name: 'Second', toBase: 1 },
        minute: { name: 'Minute', toBase: 60 },
        hour: { name: 'Hour', toBase: 3600 },
        day: { name: 'Day', toBase: 86400 },
        week: { name: 'Week', toBase: 604800 },
        month: { name: 'Month (approx)', toBase: 2629800 }, // Average month
        year: { name: 'Year (approx)', toBase: 31557600 } // Average year
    }
};

// Riferimenti agli elementi DOM
const categorySelect = document.getElementById('categorySelect');
const inputValue = document.getElementById('inputValue');
const inputUnit = document.getElementById('inputUnit');
const outputValue = document.getElementById('outputValue');
const outputUnit = document.getElementById('outputUnit');
const convertBtn = document.getElementById('convertBtn');
const swapBtn = document.getElementById('swapBtn');

// Funzione per popolare i menu a discesa delle unità
function populateUnits() {
    const selectedCategory = categorySelect.value;
    const categoryUnits = units[selectedCategory];

    inputUnit.innerHTML = ''; // Pulisci le opzioni esistenti
    outputUnit.innerHTML = '';

    for (const unitKey in categoryUnits) {
        const option = document.createElement('option');
        option.value = unitKey;
        option.textContent = categoryUnits[unitKey].name;
        inputUnit.appendChild(option);

        const option2 = document.createElement('option');
        option2.value = unitKey;
        option2.textContent = categoryUnits[unitKey].name;
        outputUnit.appendChild(option2);
    }

    // Imposta un'unità di output predefinita diversa dall'input se possibile
    if (inputUnit.options.length > 1) {
        outputUnit.value = inputUnit.options[1].value;
    } else {
        outputUnit.value = inputUnit.options[0].value;
    }
    
    // Esegui la conversione iniziale
    convertUnits();
}

// Funzione per eseguire la conversione
function convertUnits() {
    const selectedCategory = categorySelect.value;
    const value = parseFloat(inputValue.value);
    const fromUnitKey = inputUnit.value;
    const toUnitKey = outputUnit.value;

    if (isNaN(value)) {
        outputValue.value = 'Invalid Input';
        return;
    }

    const fromUnit = units[selectedCategory][fromUnitKey];
    const toUnit = units[selectedCategory][toUnitKey];

    let baseValue;

    // Gestione speciale per la temperatura
    if (selectedCategory === 'temperature') {
        baseValue = fromUnit.toBase(value); // Converte il valore input in Celsius (base)
        const converted = toUnit.fromBase(baseValue); // Converte da Celsius (base) all'unità di output
        outputValue.value = converted.toFixed(4); // Limita a 4 decimali
    } else {
        // Conversione standard per altre categorie
        baseValue = value * fromUnit.toBase; // Converti il valore input nell'unità base della categoria
        const converted = baseValue / toUnit.toBase; // Converti dall'unità base all'unità di output
        outputValue.value = converted.toFixed(4); // Limita a 4 decimali
    }
}

// Funzione per scambiare le unità di input e output
function swapUnits() {
    const tempValue = inputValue.value;
    const tempUnit = inputUnit.value;

    inputValue.value = outputValue.value;
    inputUnit.value = outputUnit.value;
    outputUnit.value = tempUnit;

    convertUnits(); // Ricalcola dopo lo scambio
}

// Listener degli eventi
categorySelect.addEventListener('change', populateUnits);
inputValue.addEventListener('input', convertUnits); // Converti al digitare
inputUnit.addEventListener('change', convertUnits);
outputUnit.addEventListener('change', convertUnits);
convertBtn.addEventListener('click', convertUnits);
swapBtn.addEventListener('click', swapUnits);

// Inizializza al caricamento della pagina
document.addEventListener('DOMContentLoaded', populateUnits);